<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>–î–Ω–µ–≤–Ω–∏–∫</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* —Ñ–æ—Ä–º–∞ (—Å–ª–∞–π–¥–µ—Ä) */
    .form-container {
      display: flex;
      width: 200%;
      transition: transform 0.5s ease-in-out;
    }
    .form-box {
      width: 50%;
      padding: 2rem;
    }

    /* –º–æ–¥–∞–ª–∫–∏: –ø–ª–∞–≤–Ω–æ–µ –ø–æ—è–≤–ª–µ–Ω–∏–µ */
    .modal {
      opacity: 0;
      transform: scale(0.97);
      transition: opacity 0.25s ease, transform 0.25s ease;
    }
    .modal.show {
      opacity: 1;
      transform: scale(1);
    }

    /* –∞–Ω–∏–º–∞—Ü–∏—è –æ—Ç–∫—Ä—ã—Ç–∏—è –∞–¥–º–∏–Ω–∫–∏ */
    #adminLogin {
      max-height: 0;
      overflow: hidden;
      opacity: 0;
      transition: max-height 0.25s ease, opacity 0.25s ease;
    }
    #adminLogin.open {
      max-height: 200px;
      opacity: 1;
    }

    /* –∞–Ω–∏–º–∞—Ü–∏—è –∫–Ω–æ–ø–∫–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ */
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }
    .syncing {
      animation: pulse 0.5s ease-in-out infinite;
    }

    /* –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –æ–Ω–ª–∞–π–Ω —Å—Ç–∞—Ç—É—Å–∞ */
    .online-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      display: inline-block;
      margin-right: 5px;
    }
    .online { background-color: #10B981; }
    .offline { background-color: #EF4444; }
    .syncing-status { background-color: #F59E0B; }
  </style>
</head>
<body id="body" class="bg-gray-200 min-h-screen p-6 transition-colors duration-300">

  <!-- –®–∞–ø–∫–∞ -->
  <div class="flex justify-center items-center mb-4 relative">
    <h1 class="text-2xl font-bold">–î–Ω–µ–≤–Ω–∏–∫</h1>
    <div id="onlineStatus" class="absolute left-4 top-0 text-sm flex items-center">
      <span class="online-dot online"></span>
      <span>–æ–Ω–ª–∞–π–Ω</span>
    </div>
    <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9ImN1cnJlbnRDb2xvciIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiPjxwYXRoIGQ9Ik0xOSAyMXYtMmE0IDQgMCAwIDAtNC00SDlhNCA0IDAgMCAwLTQgNHYyIj48L3BhdGg+PGNpcmNsZSBjeD0iMTIiIGN5PSI3IiByPSI0Ij48L2NpcmNsZT48L3N2Zz4=" 
         onclick="openAccount()" 
         class="absolute right-4 top-0 w-10 h-10 cursor-pointer p-2 bg-gray-300 dark:bg-gray-700 rounded-full hover:bg-gray-400 dark:hover:bg-gray-600 transition-colors" 
         alt="–ê–∫–∫–∞—É–Ω—Ç">
  </div>

  <!-- –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å -->
  <div class="absolute top-4 left-20 flex flex-col items-start z-40">
    <button onclick="toggleAdminLogin()" class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors">–ê–¥–º–∏–Ω</button>
    <div id="adminLogin" class="mt-3 space-x-2 flex justify-center items-center">
      <input id="adminPassword" type="password" placeholder="–ü–∞—Ä–æ–ª—å" class="border border-gray-500 text-black p-2 rounded focus:outline-none focus:ring focus:ring-blue-300 w-32">
      <button onclick="loginAdmin()" class="px-3 py-1 bg-green-500 text-white rounded hover:bg-green-600 transition-colors">–í–æ–π—Ç–∏</button>
    </div>
  </div>

  <!-- –ö–Ω–æ–ø–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ -->
  <div class="absolute top-4 left-40 flex flex-col items-start z-40">
    <button id="syncButton" onclick="forceSync()" class="px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600 transition-colors flex items-center">
      <span>–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å</span>
    </button>
    <div id="syncStatus" class="mt-1 text-xs text-gray-600 dark:text-gray-400">
      <span id="lastSyncTime">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
    </div>
  </div>

  <!-- –°–µ—Ç–∫–∞ (5 –¥–Ω–µ–π) -->
  <div class="grid grid-cols-1 md:grid-cols-5 gap-4 mt-12">
    <!-- –ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ -->
    <div class="bg-gray-800 text-white rounded-2xl shadow-lg border overflow-hidden flex flex-col">
      <div class="flex border-b border-gray-700">
        <h2 class="font-bold text-lg text-red-400 p-3 flex-1">–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫</h2>
        <div class="flex items-center border-l border-gray-600 px-3 self-stretch"><span class="font-semibold">–î–ó</span></div>
      </div>
      <div class="flex-1" id="mon"></div>
    </div>
    
    <!-- –í—Ç–æ—Ä–Ω–∏–∫ -->
    <div class="bg-gray-800 text-white rounded-2xl shadow-lg border overflow-hidden flex flex-col">
      <div class="flex border-b border-gray-700">
        <h2 class="font-bold text-lg text-blue-400 p-3 flex-1">–í—Ç–æ—Ä–Ω–∏–∫</h2>
        <div class="flex items-center border-l border-gray-600 px-3 self-stretch"><span class="font-semibold">–î–ó</span></div>
      </div>
      <div class="flex-1" id="tue"></div>
    </div>
    
    <!-- –°—Ä–µ–¥–∞ -->
    <div class="bg-gray-800 text-white rounded-2xl shadow-lg border overflow-hidden flex flex-col">
      <div class="flex border-b border-gray-700">
        <h2 class="font-bold text-lg text-green-400 p-3 flex-1">–°—Ä–µ–¥–∞</h2>
        <div class="flex items-center border-l border-gray-600 px-3 self-stretch"><span class="font-semibold">–î–ó</span></div>
      </div>
      <div class="flex-1" id="wed"></div>
    </div>
    
    <!-- –ß–µ—Ç–≤–µ—Ä–≥ -->
    <div class="bg-gray-800 text-white rounded-2xl shadow-lg border overflow-hidden flex flex-col">
      <div class="flex border-b border-gray-700">
        <h2 class="font-bold text-lg text-purple-400 p-3 flex-1">–ß–µ—Ç–≤–µ—Ä–≥</h2>
        <div class="flex items-center border-l border-gray-600 px-3 self-stretch"><span class="font-semibold">–î–ó</span></div>
      </div>
      <div class="flex-1" id="thu"></div>
    </div>
    
    <!-- –ü—è—Ç–Ω–∏—Ü–∞ -->
    <div class="bg-gray-800 text-white rounded-2xl shadow-lg border overflow-hidden flex flex-col">
      <div class="flex border-b border-gray-700">
        <h2 class="font-bold text-lg text-pink-400 p-3 flex-1">–ü—è—Ç–Ω–∏—Ü–∞</h2>
        <div class="flex items-center border-l border-gray-600 px-3 self-stretch"><span class="font-semibold">–î–ó</span></div>
      </div>
      <div class="flex-1" id="fri"></div>
    </div>
  </div>

  <!-- –ú–æ–¥–∞–ª–∫–∞ –¥–ª—è –î–ó -->
  <div id="dzModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div class="modal bg-white dark:bg-gray-900 dark:text-gray-100 p-6 rounded-2xl shadow-xl w-11/12 max-w-3xl relative">
      <button onclick="closeModal()" class="absolute top-2 right-2 text-gray-500 hover:text-red-500 transition-colors text-2xl">‚úñ</button>
      <h2 class="text-xl font-bold mb-4">–î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ</h2>
      <div id="dzContent" class="prose max-w-none dark:prose-invert max-h-96 overflow-y-auto"></div>
    </div>
  </div>

  <!-- –û–∫–Ω–æ –∞–∫–∫–∞—É–Ω—Ç–∞ -->
  <div id="accountModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div class="modal bg-white dark:bg-gray-900 dark:text-gray-100 rounded-2xl shadow-xl w-11/12 max-w-md relative overflow-hidden">
      <button onclick="closeAccount()" class="absolute top-2 right-2 text-gray-500 hover:text-red-500 transition-colors text-2xl">‚úñ</button>

      <div class="flex justify-center space-x-4 mt-4">
        <button onclick="showAuth()" class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors">–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è</button>
        <button onclick="showReg()" class="px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600 transition-colors">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
      </div>

      <div class="overflow-hidden w-full mt-4">
        <div id="formContainer" class="form-container">
          <!-- –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è -->
          <div class="form-box">
            <h2 class="text-lg font-bold mb-2">–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è</h2>
            <input type="email" id="authEmail" placeholder="Email" class="w-full mb-2 p-2 border rounded text-black">
            <input type="password" id="authPass" placeholder="–ü–∞—Ä–æ–ª—å" class="w-full mb-2 p-2 border rounded text-black">
            <input type="text" id="authCaptcha" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–∞–ø—á—É" class="w-full mb-2 p-2 border rounded text-black">
            <div id="authCaptchaText" class="mb-2 font-bold text-blue-600 text-lg tracking-wider"></div>
            <button onclick="authLogin()" class="w-full bg-blue-500 text-white py-2 rounded hover:bg-blue-600 transition-colors">–í–æ–π—Ç–∏</button>
          </div>

          <!-- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è -->
          <div class="form-box">
            <h2 class="text-lg font-bold mb-2">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h2>
            <input type="text" id="regNick" placeholder="–ù–∏–∫" class="w-full mb-2 p-2 border rounded text-black">
            <input type="email" id="regEmail" placeholder="Email" class="w-full mb-2 p-2 border rounded text-black">
            <input type="password" id="regPass" placeholder="–ü–∞—Ä–æ–ª—å" class="w-full mb-2 p-2 border rounded text-black">
            <input type="text" id="regCaptcha" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–∞–ø—á—É" class="w-full mb-2 p-2 border rounded text-black">
            <div id="regCaptchaText" class="mb-2 font-bold text-green-600 text-lg tracking-wider"></div>
            <button onclick="register()" class="w-full bg-green-500 text-white py-2 rounded hover:bg-green-600 transition-colors">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Changelog -->
  <div id="changelogModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div class="modal bg-white dark:bg-gray-900 dark:text-gray-100 p-6 rounded-2xl shadow-xl w-11/12 max-w-3xl relative">
      <button onclick="closeChangelog()" class="absolute top-2 right-2 text-gray-500 hover:text-red-500 transition-colors text-2xl">‚úñ</button>
      <h2 class="text-xl font-bold mb-4">Changelog</h2>
      <pre class="whitespace-pre-wrap text-sm bg-gray-100 dark:bg-gray-800 p-4 rounded">[+] –ü–æ–ª–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ JSONBin.io
[+] –†–µ–∂–∏–º –æ–Ω–ª–∞–π–Ω/–æ—Ñ—Ñ–ª–∞–π–Ω
[+] –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
[+] Admin Panel —Å –∑–∞—â–∏—Ç–æ–π –ø–∞—Ä–æ–ª–µ–º
[+] Switch Theme (—Ç–µ–º–Ω–∞—è/—Å–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞)
[+] –ö–∞–ø—á–∞ –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
[+] –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –¥–∏–∑–∞–π–Ω
[/] –£–ª—É—á—à–µ–Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å</pre>
    </div>
  </div>

  <!-- –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ç–µ–º—ã -->
  <div class="fixed bottom-4 left-4">
    <div id="themeToggle" onclick="toggleTheme()" class="w-16 h-8 flex items-center bg-gray-400 dark:bg-gray-600 rounded-full p-1 cursor-pointer transition">
      <div id="themeCircle" class="w-6 h-6 bg-white rounded-full shadow-md flex items-center justify-center transition-transform duration-300">
        <svg id="themeIcon" xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-yellow-500" fill="currentColor" viewBox="0 0 20 20"><path d="M10 15a5 5 0 100-10 5 5 0 000 10z"/></svg>
      </div>
    </div>
  </div>

  <!-- Changelog —Å—Å—ã–ª–∫–∞ -->
  <div class="fixed bottom-2 right-4 text-gray-500 text-sm text-right">
    <a href="#" onclick="openChangelog()" class="text-sky-500 hover:text-sky-600 underline transition-colors">Changelog</a>
    <span class="block text-xs mt-1">v1.0.0</span>
  </div>

  <script>
    // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è JSONBin
    const BIN_ID = "68bdabfbd0ea881f4075122e";
    const MASTER_KEY = "$2a$10$C/f4bag8rHTYbjAvZB5IKOgmb9WPxBQFDuzB0D48Ba8u/yLd9jdya";
    const API_URL = `https://api.jsonbin.io/v3/b/${BIN_ID}`;

    let isAdmin = false;
    let dark = false;
    let authCaptchaValue = "";
    let regCaptchaValue = "";
    let isOnline = true;
    let lessons = {
      mon: ["–ê–ª–≥–µ–±—Ä–∞","–†–û–í","–•–∏–º–∏—è","–ì–µ–æ–≥—Ä–∞—Ñ–∏—è","–ê–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫","–§–∏–∑–∏–∫–∞","–ë–∏–æ–ª–æ–≥–∏—è"],
      tue: ["–ì–µ–æ–º–µ—Ç—Ä–∏—è","–¢–µ–æ—Ä–∏—è –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏","–§–ö","–ò—Å—Ç–æ—Ä–∏—è","–†—É—Å—Å–∫–∏–π —è–∑—ã–∫","–õ–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞"],
      wed: ["–ê–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫","–§–ö","–†—É—Å—Å–∫–∏–π —è–∑—ã–∫","–ê–ª–≥–µ–±—Ä–∞","–ì–µ–æ–≥—Ä–∞—Ñ–∏—è","–ò–ö–¢"],
      thu: ["–§–∏–∑–∏–∫–∞","–ì–µ–æ–º–µ—Ç—Ä–∏—è","–ú—É–∑—ã–∫–∞","–•–∏–º–∏—è","–õ–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞","–†—É—Å—Å–∫–∏–π —è–∑—ã–∫"],
      fri: ["–û–±—â–µ—Å—Ç–≤–æ","–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è","–ê–ª–≥–µ–±—Ä–∞","–ê–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫","–ë–∏–æ–ª–æ–≥–∏—è","–û–ë–ñ","–ò—Å—Ç–æ—Ä–∏—è"]
    };
    let homework = {};
    let autoRefreshInterval;

    // Fallback –¥–∞–Ω–Ω—ã–µ
    const defaultHomework = {
      "–ê–ª–≥–µ–±—Ä–∞": "–£—á–µ–±–Ω–∏–∫ —Å—Ç—Ä. 45, ‚Ññ1-5",
      "–ì–µ–æ–º–µ—Ç—Ä–∏—è": "–ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å—Å—è –∫ –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–æ–π",
      "–†—É—Å—Å–∫–∏–π —è–∑—ã–∫": "–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ 123",
      "–õ–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞": "–ü—Ä–æ—á–∏—Ç–∞—Ç—å —Ä–∞—Å—Å–∫–∞–∑",
      "–ò—Å—Ç–æ—Ä–∏—è": "–ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –¥–æ–∫–ª–∞–¥",
      "–ê–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫": "–í—ã—É—á–∏—Ç—å —Å–ª–æ–≤–∞ –∏–∑ —É—Ä–æ–∫–∞ 5",
      "–§–∏–∑–∏–∫–∞": "–õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è —Ä–∞–±–æ—Ç–∞ ‚Ññ3",
      "–•–∏–º–∏—è": "–†–µ—à–∏—Ç—å –∑–∞–¥–∞—á–∏ –Ω–∞ —Å—Ç—Ä. 78",
      "–ë–∏–æ–ª–æ–≥–∏—è": "–ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—é –æ –∫–ª–µ—Ç–∫–µ",
      "–ì–µ–æ–≥—Ä–∞—Ñ–∏—è": "–°–æ—Å—Ç–∞–≤–∏—Ç—å –∫–∞—Ä—Ç—É –ø—Ä–∏—Ä–æ–¥–Ω—ã—Ö –∑–æ–Ω",
      "–§–ö": "–ü—Ä–∏–Ω–µ—Å—Ç–∏ —Å–ø–æ—Ä—Ç–∏–≤–Ω—É—é —Ñ–æ—Ä–º—É",
      "–û–ë–ñ": "–ü–æ–≤—Ç–æ—Ä–∏—Ç—å –ø—Ä–∞–≤–∏–ª–∞ –ø–µ—Ä–≤–æ–π –ø–æ–º–æ—â–∏",
      "–ò–ö–¢": "–°–æ–∑–¥–∞—Ç—å –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—é –≤ PowerPoint",
      "–ú—É–∑—ã–∫–∞": "–í—ã—É—á–∏—Ç—å —Å–ª–æ–≤–∞ –≥–∏–º–Ω–∞",
      "–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è": "–ü—Ä–∏–≥–æ—Ç–æ–≤–∏—Ç—å –ø—Ä–æ—Å—Ç–æ–µ –±–ª—é–¥–æ",
      "–û–±—â–µ—Å—Ç–≤–æ": "–ù–∞–ø–∏—Å–∞—Ç—å —ç—Å—Å–µ –æ –ø—Ä–∞–≤–∞—Ö —á–µ–ª–æ–≤–µ–∫–∞",
      "–†–û–í": "–ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –í–û–í",
      "–¢–µ–æ—Ä–∏—è –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏": "–†–µ—à–∏—Ç—å –∑–∞–¥–∞—á–∏ –Ω–∞ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å"
    };

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–Ω–ª–∞–π–Ω —Å—Ç–∞—Ç—É—Å–∞
    function checkOnlineStatus() {
      isOnline = navigator.onLine;
      const statusElement = document.getElementById('onlineStatus');
      const dot = statusElement.querySelector('.online-dot');
      
      if (isOnline) {
        statusElement.innerHTML = '<span class="online-dot online"></span><span>–æ–Ω–ª–∞–π–Ω</span>';
      } else {
        statusElement.innerHTML = '<span class="online-dot offline"></span><span>–æ—Ñ—Ñ–ª–∞–π–Ω</span>';
      }
      
      return isOnline;
    }

    // –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
    function startAutoRefresh() {
      stopAutoRefresh();
      autoRefreshInterval = setInterval(() => {
        if (checkOnlineStatus()) {
          loadData();
        }
      }, 30000); // 30 —Å–µ–∫—É–Ω–¥
    }

    function stopAutoRefresh() {
      if (autoRefreshInterval) {
        clearInterval(autoRefreshInterval);
      }
    }

    // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
    async function loadData() {
      try {
        if (!checkOnlineStatus()) {
          throw new Error("–ù–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É");
        }

        updateSyncStatus("syncing", "–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è...");
        
        const timestamp = Date.now();
        const res = await fetch(`${API_URL}/latest?nocache=${timestamp}`, {
          method: 'GET',
          headers: { 
            "X-Master-Key": MASTER_KEY,
            "X-Bin-Meta": "false",
            "Cache-Control": "no-cache",
            "Pragma": "no-cache"
          },
          cache: 'no-store'
        });

        if (!res.ok) {
          throw new Error(`HTTP error! status: ${res.status}`);
        }
        
        const data = await res.json();
        homework = data.record || {};
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ª–æ–∫–∞–ª—å–Ω—É—é –∫–æ–ø–∏—é
        localStorage.setItem('diaryHomework', JSON.stringify(homework));
        localStorage.setItem('lastOnlineSync', new Date().toISOString());
        
        renderAll();
        
        const now = new Date().toLocaleTimeString();
        updateSyncStatus("online", `–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–æ: ${now}`);
        
        console.log("‚úì –î–∞–Ω–Ω—ã–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã:", now);
        return true;
        
      } catch (error) {
        console.error("‚úó –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:", error);
        
        // –ü—ã—Ç–∞–µ–º—Å—è –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∫—ç—à–∞
        try {
          const cached = localStorage.getItem('diaryHomework');
          if (cached) {
            homework = JSON.parse(cached);
            renderAll();
            updateSyncStatus("offline", "–õ–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–æ—Ñ—Ñ–ª–∞–π–Ω)");
            console.log("–ó–∞–≥—Ä—É–∂–µ–Ω—ã –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ");
          } else {
            homework = {...defaultHomework};
            renderAll();
            updateSyncStatus("offline", "Default –¥–∞–Ω–Ω—ã–µ (–æ—Ñ—Ñ–ª–∞–π–Ω)");
          }
        } catch (cacheError) {
          console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑ –∫—ç—à–∞:", cacheError);
          homework = {...defaultHomework};
          renderAll();
          updateSyncStatus("offline", "–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏");
        }
        
        return false;
      }
    }

    async function saveData() {
      try {
        // –°–Ω–∞—á–∞–ª–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –ª–æ–∫–∞–ª—å–Ω–æ
        localStorage.setItem('diaryHomework', JSON.stringify(homework));
        
        if (!checkOnlineStatus()) {
          updateSyncStatus("offline", "–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ –ª–æ–∫–∞–ª—å–Ω–æ (–æ—Ñ—Ñ–ª–∞–π–Ω)");
          return true;
        }
        
        updateSyncStatus("syncing", "–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä...");
        
        const res = await fetch(API_URL, {
          method: "PUT",
          headers: {
            "Content-Type": "application/json",
            "X-Master-Key": MASTER_KEY,
            "X-Bin-Versioning": "false"
          },
          body: JSON.stringify(homework)
        });
        
        if (!res.ok) {
          throw new Error(`HTTP error! status: ${res.status}`);
        }
        
        localStorage.setItem('lastOnlineSync', new Date().toISOString());
        updateSyncStatus("online", "–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä");
        
        console.log("‚úì –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä");
        return true;
        
      } catch (error) {
        console.error("‚úó –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:", error);
        updateSyncStatus("offline", "–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ –ª–æ–∫–∞–ª—å–Ω–æ (–æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞)");
        return false;
      }
    }

    function updateSyncStatus(status, message) {
      const syncStatus = document.getElementById('syncStatus');
      const lastSyncTime = document.getElementById('lastSyncTime');
      const onlineStatus = document.getElementById('onlineStatus');
      
      if (lastSyncTime) {
        lastSyncTime.textContent = message;
      }
      
      if (onlineStatus) {
        let html = '';
        switch(status) {
          case "online":
            html = '<span class="online-dot online"></span><span>–æ–Ω–ª–∞–π–Ω</span>';
            break;
          case "offline":
            html = '<span class="online-dot offline"></span><span>–æ—Ñ—Ñ–ª–∞–π–Ω</span>';
            break;
          case "syncing":
            html = '<span class="online-dot syncing-status"></span><span>—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è...</span>';
            break;
        }
        onlineStatus.innerHTML = html;
      }
    }

    function forceSync() {
      if (!checkOnlineStatus()) {
        alert("‚ùå –ù–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ.");
        return;
      }
      
      const button = document.getElementById('syncButton');
      const originalText = button.textContent;
      
      button.textContent = "–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è...";
      button.disabled = true;
      button.classList.add('syncing', 'opacity-50');
      
      loadData().finally(() => {
        setTimeout(() => {
          button.textContent = originalText;
          button.disabled = false;
          button.classList.remove('syncing', 'opacity-50');
        }, 1000);
      });
    }

    // –û—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (renderLessons, renderAll, editHW, autoLink, openModal, closeModal, etc.)
    // ... [–∑–¥–µ—Å—å –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –∫–æ–¥–∞] ...

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    window.onload = async () => {
      const savedTheme = localStorage.getItem('theme');
      if (savedTheme === 'dark') dark = true;
      applyTheme(false);
      
      refreshCaptchas();
      checkOnlineStatus();
      
      // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ
      await loadData();
      
      // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
      startAutoRefresh();
      
      // –°–ª—É—à–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ–Ω–ª–∞–π–Ω —Å—Ç–∞—Ç—É—Å–∞
      window.addEventListener('online', () => {
        checkOnlineStatus();
        loadData();
      });
      
      window.addEventListener('offline', () => {
        checkOnlineStatus();
        updateSyncStatus("offline", "–û—Ñ—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º");
      });
      
      console.log("üöÄ –î–Ω–µ–≤–Ω–∏–∫ –∑–∞–ø—É—â–µ–Ω");
    };

    // –î–æ–±–∞–≤—å—Ç–µ –∑–¥–µ—Å—å –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –∫–æ–¥–∞
    // (renderLessons, renderAll, editHW, autoLink, openModal, closeModal, 
    // toggleAdminLogin, loginAdmin, applyTheme, toggleTheme, generateCaptcha,
    // refreshCaptchas, openAccount, closeAccount, showAuth, showReg, 
    // authLogin, register, openChangelog, closeChangelog)

  </script>
</body>
</html>